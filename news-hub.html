---
layout: default
title: News Hub
permalink: /news/hub/
---
<style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@900&family=Inter:wght@400&display=swap');
    
    main { 
        padding: 2rem 1rem 80px 1rem; 
        max-width: 900px; 
        margin: 0 auto; 
        /* Min-height prevents footer jumping (layout shift) */
        min-height: 80vh; 
    }
    
    .page-header { text-align: center; margin-bottom: 2.5rem; }
    .page-header h1 { font-size: 2.5rem; color: #1c1e21; }
    .page-header .tag-highlight { color: #0073e6; }
    .page-header p { font-size: 1.1rem; color: #606770; margin-top: 0.5rem; }
    
    .news-grid-full { 
        display: grid; 
        grid-template-columns: 1fr; 
        gap: 1.5rem; 
        /* Min-height ensures the grid holds its shape during updates */
        min-height: 200px;
    }
    
    .news-card {
        background-color: #fff; 
        border-radius: 12px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        overflow: hidden; 
        text-decoration: none; 
        color: inherit; 
        display: flex; 
        flex-direction: column;
        /* Optimized transitions */
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        will-change: transform; /* Performance Hint for Browser */
    }

    /* Only animate when specifically requested (new content) */
    .news-card.fade-in {
        animation: smoothFade 0.5s ease-out forwards;
        opacity: 0;
    }
    
    @keyframes smoothFade {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .news-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
    
    .news-card .news-card-image-wrapper {
        overflow: hidden; width: 100%; height: 220px; background-color: #f3f4f6;
        position: relative;
    }
    
    .news-card-image {
        width: 100%; height: 100%; object-fit: cover; 
        transition: opacity 0.3s ease;
    }
    
    .news-card-text { padding: 1rem 1.5rem; }
    
    .news-card-headline {
        font-family: 'Merriweather', serif; font-weight: 900;
        font-size: 1.5rem; color: #1c1e21;
        margin-bottom: 0.5rem; line-height: 1.3;
    }
    
    .news-card-subheadline {
        font-family: 'Inter', sans-serif; font-weight: 400;
        font-size: 1rem; color: #606770; line-height: 1.6;
    }
    
    .no-results-message { text-align: center; color: #606770; padding: 2rem; display: none;}
    
    .loader {
        display: none; margin: 3rem auto; 
        border: 4px solid #f3f3f3;
        border-top: 4px solid #0073e6; 
        border-radius: 50%;
        width: 40px; height: 40px; 
        animation: spin 1s linear infinite;
    }
    .loader.visible { display: block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    @media (min-width: 768px) {
        .news-card { flex-direction: row; }
        .news-card .news-card-image-wrapper { width: 300px; height: auto; flex-shrink: 0; }
        .news-card-text { display: flex; flex-direction: column; justify-content: center; }
    }
</style>

<main>
    <div class="page-header">
        <h1 id="page-title">News Hub</h1>
        <p id="page-subtitle">The latest trends, research, and important discussions from around the world.</p>
    </div>

    <div class="news-grid-full" id="articles-grid"></div>

    <div id="loader" class="loader"></div>
    <p id="no-results-message" class="no-results-message"></p>
</main>

<script>
document.addEventListener('turbo:load', async () => {
    const grid = document.getElementById('articles-grid');
    const loader = document.getElementById('loader');
    const noResultsMsg = document.getElementById('no-results-message');
    const pageTitle = document.getElementById('page-title');
    const pageSubtitle = document.getElementById('page-subtitle');
    
    const CACHE_KEY = 'tmp_news_hub_v2';
    
    // --- UTILS ---
    function formatTag(tag) {
        if (tag === 'art-culture') return 'Art & Culture';
        return tag.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }

    function filterArticles(articles, tag) {
        if (!tag) return articles;
        return articles.filter(post => {
            const postTags = post.tags ? post.tags.split(',').map(t => t.trim()) : [];
            return postTags.includes(tag);
        });
    }

    function buildCardsHTML(articles, shouldAnimate) {
        if (!articles || articles.length === 0) return '';
        
        // Only render top 50 for performance
        return articles.slice(0, 50).map(post => {
            const image = post.image || 'https://placehold.co/600x400/e2e8f0/64748b?text=No+Image';
            const alt = post.image_description || 'Article image';
            const subheadline = post.subheadline || 'Click to read more.';
            const animClass = shouldAnimate ? 'fade-in' : '';
            
            return `
            <a href="${post.url}" class="news-card ${animClass}">
                <div class="news-card-image-wrapper">
                    <img src="${image}" alt="${alt}" class="news-card-image" loading="lazy">
                </div>
                <div class="news-card-text">
                    <h3 class="news-card-headline">${post.title}</h3>
                    <p class="news-card-subheadline">${subheadline}</p>
                </div>
            </a>`;
        }).join('');
    }

    function updateUI(articles, animate = false) {
        const urlParams = new URLSearchParams(window.location.search);
        const tagFilter = urlParams.get('tag');

        // Update Header
        if (tagFilter) {
            pageTitle.innerHTML = `News in <span class="tag-highlight">${formatTag(tagFilter)}</span>`;
            pageSubtitle.style.display = 'none';
        } else {
            pageTitle.innerHTML = 'News Hub';
            pageSubtitle.style.display = 'block';
        }

        const filtered = filterArticles(articles, tagFilter);

        if (filtered.length === 0) {
            grid.innerHTML = '';
            noResultsMsg.textContent = tagFilter ? `No articles found for "${formatTag(tagFilter)}".` : "No articles found.";
            noResultsMsg.style.display = 'block';
            return;
        }

        noResultsMsg.style.display = 'none';
        
        // IMPORTANT: Build HTML string first
        const newHTML = buildCardsHTML(filtered, animate);
        
        grid.innerHTML = newHTML;
    }

    // --- STABLE LOADING LOGIC ---

    // 1. Check if Turbo already restored the content
    if (grid.childElementCount > 0) {
        console.log("Content restored by Turbo. Skipping initial render.");
    } else {
        // 2. If empty, try LocalStorage (Instant Load)
        const cachedData = localStorage.getItem(CACHE_KEY);
        if (cachedData) {
            try {
                const articles = JSON.parse(cachedData);
                updateUI(articles, false); // false = No animation (instant appear)
            } catch (e) {
                console.error("Cache invalid");
                localStorage.removeItem(CACHE_KEY);
            }
        } else {
            // 3. Only show loader if absolutely nothing is on screen
            loader.classList.add('visible');
        }
    }

    // 4. Background Update (Optimized with setTimeout)
    // This small delay (100ms) allows the page transition animation to finish 
    // BEFORE the browser freezes to parse the potentially large JSON file.
    setTimeout(async () => {
        try {
            const response = await fetch('/search.json');
            if (!response.ok) throw new Error('Network error');
            
            const freshArticles = await response.json();
            
            // 5. Smart Compare
            const cachedData = localStorage.getItem(CACHE_KEY);
            const cachedArticles = cachedData ? JSON.parse(cachedData) : [];
            
            const isNewContent = !cachedData || 
                                 freshArticles.length !== cachedArticles.length || 
                                 (freshArticles[0] && cachedArticles[0] && freshArticles[0].url !== cachedArticles[0].url);

            if (isNewContent) {
                console.log("New content detected. Updating...");
                localStorage.setItem(CACHE_KEY, JSON.stringify(freshArticles));
                // This is a real update, so we allow animation
                updateUI(freshArticles, true);
            } else {
                console.log("Content up to date. No re-render.");
            }
            
        } catch (error) {
            console.error("Background update failed:", error);
            if (grid.childElementCount === 0) {
                noResultsMsg.textContent = "Could not load articles.";
                noResultsMsg.style.display = 'block';
            }
        } finally {
            loader.classList.remove('visible');
        }
    }, 100); // <-- CRITICAL FIX: 100ms delay
});
</script>
